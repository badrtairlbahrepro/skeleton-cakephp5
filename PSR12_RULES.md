# üìê R√®gles PSR-12 et Standards PHP

## üéØ Table des Mati√®res

1. [C'est quoi PSR ?](#cest-quoi-psr)
2. [PSR-12 : Standards PHP](#psr-12-standards-php)
3. [Les R√®gles Principales](#les-r√®gles-principales)
4. [Autres Standards (PSR-1, PSR-4, etc.)](#autres-standards)
5. [Pourquoi Suivre ces Standards ?](#pourquoi-suivre-ces-standards)

---

## ü§î C'est quoi PSR ?

**PSR = PHP Standards Recommendations**

### D√©finition Simple

PSR sont des **r√®gles** cr√©√©es par la **PHP-FIG** (PHP Framework Interop Group).

**PHP-FIG** = Groupe de d√©veloppeurs de frameworks PHP (Symfony, Laravel, CakePHP, etc.)

### Leur But

**Standardiser** le code PHP pour que :
- ‚úÖ Tout le monde √©crit de la m√™me fa√ßon
- ‚úÖ Le code est lisible par tous
- ‚úÖ Collaboration facilit√©e
- ‚úÖ Compatibilit√© entre frameworks

### Historique des PSR

```
PSR-0  ‚Üí Autoloading (ancien, remplac√©)
PSR-1  ‚Üí Coding Standard (basique)
PSR-2  ‚Üí Coding Style (ancien)
PSR-3  ‚Üí Logger Interface
PSR-4  ‚Üí Autoloading (moderne)
PSR-7  ‚Üí HTTP Message Interface
PSR-12 ‚Üí Coding Style (moderne, remplace PSR-2)
```

---

## üìã PSR-12 : Standards PHP

### Vue d'Ensemble

**PSR-12** est l'extension de **PSR-1** qui d√©finit le **style de code**.

Il remplace **PSR-2** (plus moderne et complet).

### Les R√®gles Principales

#### 1. **Longueur de Ligne (Line Length)**

```php
// ‚ùå TROP LONG (125 caract√®res)
$this->Html->tag('span', $this->Html->tag('i', '', ['class' => $icon]), ['class' => 'input-group-text']);

// ‚úÖ CORRECT (< 120 caract√®res)
$this->Html->tag(
    'span',
    $this->Html->tag('i', '', ['class' => $icon]),
    ['class' => 'input-group-text']
);
```

**R√®gle :** Maximum **120 caract√®res** par ligne.

**Pourquoi ?**
- Lisible sur tous les √©crans
- Pas de scroll horizontal
- Code reviews faciles

#### 2. **Indentation**

```php
// ‚ùå MAUVAIS (espaces mixtes)
function test(){
    $a = 1;
      $b = 2; // Incoh√©rent
}

// ‚úÖ BON (4 espaces)
function test(): void
{
    $a = 1;
    $b = 2; // Coh√©rent
}
```

**R√®gle :** Utiliser **4 espaces** (jamais de tabs).

**Pourquoi ?**
- Uniforme sur tous les √©diteurs
- Indentation visible et pr√©visible

#### 3. **Types de Retour**

```php
// ‚ùå MAUVAIS (pas de type de retour)
function add($a, $b) {
    return $a + $b;
}

// ‚úÖ BON (type de retour explicite)
function add(int $a, int $b): int {
    return $a + $b;
}
```

**R√®gle :** Toujours d√©clarer les **types de retour**.

**Pourquoi ?**
- PHP sait ce qui est attendu
- Erreurs d√©tect√©es plus t√¥t
- IDE peut aider mieux

#### 4. **Guillemets Simples**

```php
// ‚ùå MAUVAIS (guillemets doubles)
$text = "Hello World";

// ‚úÖ BON (guillemets simples)
$text = 'Hello World';
```

**R√®gle :** Utiliser des **guillemets simples** sauf pour les variables.

**Pourquoi ?**
- Plus rapide (pas d'interpr√©tation)
- Moins de risques d'erreurs

#### 5. **Syntaxe Tableau Court**

```php
// ‚ùå MAUVAIS (ancien)
$arr = array('a', 'b', 'c');

// ‚úÖ BON (moderne)
$arr = ['a', 'b', 'c'];
```

**R√®gle :** Utiliser la syntaxe courte `[]`.

**Pourquoi ?**
- Plus moderne (PHP 5.4+)
- Plus court √† √©crire
- Plus lisible

#### 6. **Namespace et Use**

```php
// ‚úÖ BON (namespace en premier)
<?php
declare(strict_types=1);

namespace App\Controller;

use App\Model\User;
use Cake\Controller\Controller;

class UsersController extends Controller
{
    // ...
}
```

**R√®gle :**
1. `<?php` en premi√®re ligne
2. `declare(strict_types=1);` en deuxi√®me ligne
3. **1 ligne vide**
4. `namespace`
5. **1 ligne vide**
6. `use` statements (tri√©s alphab√©tiquement)
7. **1 ligne vide**
8. Classe

**Pourquoi ?**
- Ordre logique
- Facile √† trouver les imports

#### 7. **Classes et M√©thodes**

```php
// ‚úÖ BON (structuration claire)
class UserController extends Controller
{
    public function index(): void
    {
        // Code ici
    }
    
    private function helperMethod(): string
    {
        // Code ici
        return 'result';
    }
}
```

**R√®gle :**
- **Classe** : accolade ouvrante `{` sur nouvelle ligne
- **M√©thode** : accolade ouvrante `{` sur nouvelle ligne
- **Visibilit√©** : toujours d√©clarer `public`, `private`, ou `protected`

**Pourquoi ?**
- Coh√©rence dans tout le code
- Facile √† identifier les sections

#### 8. **Op√©rateurs et Espaces**

```php
// ‚ùå MAUVAIS
$a=$b+$c;
if($a==$b){

// ‚úÖ BON
$a = $b + $c;
if ($a == $b) {
```

**R√®gle :**
- Espacer les op√©rateurs : `=`, `+`, `-`, `*`, `/`, `==`, etc.
- Pas d'espace apr√®s les parenth√®ses ouvrantes : `if (` pas `if( `
- Pas d'espace avant les parenth√®ses fermantes : `) {` pas `)  {`

**Pourquoi ?**
- Plus lisible
- √âvite les confusions

#### 9. **Multiligne (Array Arguments)**

```php
// ‚ùå MAUVAIS
$result = function($param1, $param2, $param3, $param4, $param5, $param6);

// ‚úÖ BON
$result = function(
    $param1,
    $param2,
    $param3,
    $param4,
    $param5,
    $param6
);
```

**R√®gle :**
- Si ligne > 120 caract√®res, passer √† la ligne
- Un argument par ligne
- Parenth√®se fermante sur sa propre ligne

**Pourquoi ?**
- Plus facile √† lire
- Diff√©rences facilement visibles (git diff)

#### 10. **M√©thodes Ch√¢in√©es**

```php
// ‚ùå MAUVAIS
$obj->method1()->method2()->method3();

// ‚úÖ BON (chaque m√©thode sur sa ligne)
$obj->method1()
    ->method2()
    ->method3();
```

**R√®gle :** Chaque appel sur une nouvelle ligne.

**Pourquoi ?**
- Facile √† ajouter/supprimer des appels
- Plus facile √† d√©boguer

---

## üîÑ Autres Standards

### PSR-1 : Coding Standard (Basique)

#### R√®gle 1 : Classes en PascalCase

```php
// ‚úÖ BON
class UserController
class UserRepository
class EmailService

// ‚ùå MAUVAIS
class user_controller
class userController
class USER_CONTROLLER
```

#### R√®gle 2 : M√©thodes en camelCase

```php
// ‚úÖ BON
public function getUserById(): User
public function createNewUser(): void
public function validateEmail(): bool

// ‚ùå MAUVAIS
public function get_user_by_id()
public function GetUserById()
public function GET_USER_BY_ID()
```

#### R√®gle 3 : Constantes en MAJUSCULES

```php
// ‚úÖ BON
class Config
{
    public const MAX_LOGIN_ATTEMPTS = 5;
    public const DEFAULT_TIMEOUT = 30;
    private const SECRET_KEY = 'abc123';
}

// ‚ùå MAUVAIS
public const max_login_attempts = 5;
public const defaultTimeout = 30;
```

### PSR-4 : Autoloading (Automatique)

#### R√®gle : Namespace = Structure de Dossiers

```
projet/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ App/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Controller/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ UsersController.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Model/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ User.php
```

**Correspondance :**
- Namespace: `App\Controller\UsersController`
- Chemin: `src/App/Controller/UsersController.php`

#### Configuration dans composer.json

```json
{
    "autoload": {
        "psr-4": {
            "App\\": "src/"
        }
    }
}
```

**Pourquoi ?**
- PHP trouve automatiquement les classes
- Plus de `require` partout
- Standardis√©

### PSR-7 : HTTP Message Interface

#### R√®gles pour les Requ√™tes/R√©ponses

```php
// ‚úÖ BON (PSR-7)
$request = $request->withMethod('POST');
$request = $request->withUri(new Uri('https://example.com'));
$response = $response->withStatus(200);

// ‚ùå MAUVAIS (framework sp√©cifique)
$request->method = 'POST'; // Ne marche que dans un framework
```

**Pourquoi ?**
- Compatible entre frameworks
- R√©utilisable

### PSR-3 : Logger Interface

#### Standard pour la Logging

```php
// ‚úÖ BON (PSR-3)
$logger->info('User logged in', ['user_id' => 123]);
$logger->error('Database connection failed');
$logger->warning('Low memory', ['usage' => '90%']);

// ‚ùå MAUVAIS (personnalis√©)
$logger->log('User logged in', 'info');
```

---

## üéØ Pourquoi Suivre ces Standards ?

### 1. **Lisible par Tous**

```
Code sans standard:
‚Üí Chacun √©crit √† sa fa√ßon
‚Üí Difficile de comprendre le code des autres
‚Üí Temps perdu √† d√©coder

Code avec PSR-12:
‚Üí Tout le monde √©crit pareil
‚Üí Lecture imm√©diate
‚Üí Focus sur la logique, pas le style
```

### 2. **Collaboration Facile**

**Sc√©nario typique :**

Sans standard :
```
Alice : "Pourquoi tu utilises des tabs ?"
Bob   : "C'est plus rapide que des espaces"
Alice : "Mais moi j'aime les espaces"
Bob   : "..."
R√©sultat : Code incoh√©rent, conflits Git constants
```

Avec PSR-12 :
```
Alice : "Le code respecte PSR-12 ‚úÖ"
Bob   : "Oui, c'est automatique ‚úÖ"
R√©sultat : Code uniforme, z√©ro conflit de style
```

### 3. **√âvite les Conflits Git**

**Sans standard :**
```diff
- function test(){
- return $a+$b;
+ function test(){
+ return $a + $b;
+ }
```

**Avec PSR-12 (auto-format√©) :**
```diff
- Pas de conflit car format√© automatiquement
```

### 4. **Tools Support**

Tous les outils supportent PSR-12 :
- ‚úÖ **PHPStorm** - Auto-format int√©gr√©
- ‚úÖ **VSCode** - Extensions PSR-12
- ‚úÖ **PHP_CodeSniffer** - V√©rification auto
- ‚úÖ **PHP-CS-Fixer** - Correction auto

### 5. **Professionnalisme**

**Code respectant PSR-12 = Code Pro**

Les employeurs/reviewers voient :
- ‚úÖ Attention aux d√©tails
- ‚úÖ Code maintenable
- ‚úÖ Exp√©rience avec les standards
- ‚úÖ Facile √† int√©grer dans une √©quipe

### 6. **D√©buggabilit√©**

**Code Standard :**
- On sait o√π chercher les erreurs
- Stack traces coh√©rentes
- Logs uniformes

**Code Non-Standard :**
- "O√π est l'erreur ?" ü§î
- Format bizarre dans les logs
- Difficult√© √† identifier le probl√®me

---

## üìä R√©sum√© des R√®gles Essentielles

| Cat√©gorie | R√®gle PSR-12 | Exemple |
|-----------|--------------|---------|
| **Longueur** | Max 120 caract√®res | Voir section 1 |
| **Indentation** | 4 espaces | `    $var = 1;` |
| **Guillemets** | Simples si possible | `'text'` pas `"text"` |
| **Tableaux** | Syntaxe courte | `[]` pas `array()` |
| **Types** | Toujours d√©clarer | `function test(): int` |
| **Namespace** | En haut du fichier | `namespace App\Controller;` |
| **Classes** | PascalCase | `UserController` |
| **M√©thodes** | camelCase | `getUserById()` |
| **Constantes** | MAJUSCULES | `MAX_SIZE` |
| **Op√©rateurs** | Espac√©s | `$a = $b + $c` |
| **Multiligne** | Un param par ligne | Voir section 9 |

---

## üîß Outils pour Appliquer PSR-12

### Automatique

```bash
# 1. PHP_CodeSniffer - V√©rifier
composer cs-check

# 2. PHP-CS-Fixer - Corriger
composer cs-fix

# 3. Tout v√©rifier
composer check
```

### Manuelle

**√âditeurs de Code :**

**PHPStorm :**
```
File ‚Üí Settings ‚Üí Editor ‚Üí Code Style ‚Üí PHP
‚Üí Set from ‚Üí PSR1/PSR2
```

**VSCode :**
```json
// .vscode/settings.json
{
    "php.suggest.basic": false,
    "intelephense.format.braces": "allman"
}
```

---

## üéì Conclusion

### Les Standards Principaux

1. **PSR-1** ‚Üí Noms et structure de base
2. **PSR-4** ‚Üí Organisation des fichiers
3. **PSR-12** ‚Üí Style de code (le plus important)
4. **PSR-3** ‚Üí Logging
5. **PSR-7** ‚Üí HTTP

### Pourquoi les Suivre ?

‚úÖ Code lisible par tous
‚úÖ Collaboration facilit√©e
‚úÖ Moins de conflits Git
‚úÖ Professionnalisme
‚úÖ Maintenance facilit√©e

### Comment les Appliquer ?

```bash
# Automatiquement
composer cs-fix

# V√©rifier
composer cs-check
```

**Bonne pratique :** Avant chaque commit !
```bash
composer check  # Tests + Qualit√©
```

---

**üéâ Avec PSR-12, votre code est propre et professionnel ! üöÄ**

